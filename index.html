<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Ganadero B&M</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --verde:#2e7d32;
  --gris:#f4f6f8;
  --card:#ffffff;
  --texto:#222;
}

body{
  margin:0;
  font-family: system-ui, Arial;
  background:var(--gris);
  color:var(--texto);
}

header{
  background:var(--verde);
  color:white;
  padding:15px 20px;
  font-size:20px;
  font-weight:600;
}

.container{
  padding:20px;
  max-width:1100px;
}

.section{
  background:var(--card);
  border-radius:14px;
  padding:16px;
  margin-bottom:20px;
  box-shadow:0 4px 10px rgba(0,0,0,.06);
}

h2{
  margin-top:0;
  color:var(--verde);
}

input, select, button{
  padding:10px;
  margin:6px 0;
  font-size:15px;
}

input, select{
  width:100%;
}

button{
  background:var(--verde);
  color:white;
  border:none;
  border-radius:10px;
  cursor:pointer;
  font-weight:600;
}

button.secondary{
  background:#ddd;
  color:#222;
}

.row{
  display:flex;
  gap:15px;
}

.card{
  flex:1;
  background:#fafafa;
  border-radius:10px;
  padding:12px;
  text-align:center;
  cursor:pointer;
  border:1px solid #ddd;
}

.card b{
  font-size:18px;
}

.list-item{
  border-bottom:1px solid #ddd;
  padding:6px 0;
  cursor:pointer;
}
</style>
</head>

<body>

<header>Ganadero B&M</header>

<div class="container">

<!-- ESTABLECIMIENTO -->
<div class="section" id="secEst">
  <h2>Establecimiento</h2>
  <input id="estNombre" placeholder="Nombre del establecimiento">
  <button onclick="guardarEst()">Guardar</button>
</div>

<!-- SELECCIÓN DE RODEO -->
<div class="section">
  <h2>Rodeo</h2>
  <select id="rodeoSel" onchange="actualizarResumen()"></select>
  <p id="infoRodeo"></p>

  <div class="row">
    <div class="card" onclick="listar('Vaca')">
      <b id="cntVacas">0</b><br>Vacas
    </div>
    <div class="card" onclick="listar('Toro')">
      <b id="cntToros">0</b><br>Toros
    </div>
    <div class="card" onclick="listar('Ternero')">
      <b id="cntTerneros">0</b><br>Terneros/as
    </div>
  </div>
</div>

<!-- LISTADO -->
<div class="section">
  <h2>Listado</h2>
  <div id="lista"></div>
</div>

<!-- ALTAS -->
<div class="section">
  <h2>Alta</h2>

  <select id="tipoAlta" onchange="formAlta()">
    <option value="">¿Qué vas a dar de alta?</option>
    <option>Vaca</option>
    <option>Toro</option>
    <option>Ternero</option>
  </select>

  <div id="formulario"></div>
</div>

</div>

<script>
let data = JSON.parse(localStorage.getItem("ganaderoBM")) || {
  establecimiento:"",
  rodeos:[
    { nombre:"General", lote:"Lote 1", animales:[] }
  ],
  ultimoTernero:0,
  fechaDef: new Date().toISOString().slice(0,10)
};

function save(){
  localStorage.setItem("ganaderoBM", JSON.stringify(data));
}

function guardarEst(){
  data.establecimiento = estNombre.value;
  save();
  secEst.style.display="none";
}

if(data.establecimiento){
  secEst.style.display="none";
}

function cargarRodeos(){
  rodeoSel.innerHTML="";
  data.rodeos.forEach((r,i)=>{
    rodeoSel.innerHTML+=`<option value="${i}">${r.nombre}</option>`;
  });
}
cargarRodeos();

function actualizarResumen(){
  let r=data.rodeos[rodeoSel.value];
  let v=0,t=0,te=0;
  r.animales.forEach(a=>{
    if(a.tipo=="Vaca")v++;
    if(a.tipo=="Toro")t++;
    if(a.tipo=="Ternero")te++;
  });
  cntVacas.innerText=v;
  cntToros.innerText=t;
  cntTerneros.innerText=te;
  infoRodeo.innerText=`Lote actual: ${r.lote}`;
}
actualizarResumen();

function listar(tipo){
  let r=data.rodeos[rodeoSel.value];
  lista.innerHTML="";
  r.animales.filter(a=>a.tipo==tipo).forEach(a=>{
    lista.innerHTML+=`<div class="list-item"><b>${a.id}</b> – ${a.color || ""}</div>`;
  });
}

function formAlta(){
  let t=tipoAlta.value;
  formulario.innerHTML="";
  if(!t) return;

  if(t=="Ternero"){
    data.ultimoTernero++;
    formulario.innerHTML=`
      <select id="sexo">
        <option>M</option><option>H</option>
      </select>
      <select id="color">
        <option>N</option><option>C</option><option>PN</option><option>PC</option>
      </select>
      <input id="caravana" value="${data.ultimoTernero}">
      <label><input type="checkbox" id="sinCar"> Sin caravanear</label>
      <input type="date" id="fecha" value="${data.fechaDef}">
      <button onclick="altaTernero()">Guardar</button>
    `;
  }
}

function altaTernero(){
  let r=data.rodeos[rodeoSel.value];
  let car=sinCar.checked ? "SC" : caravana.value;
  data.fechaDef=fecha.value;
  r.animales.push({
    tipo:"Ternero",
    id:car,
    sexo:sexo.value,
    color:color.value,
    fecha:fecha.value
  });
  save();
  actualizarResumen();
  listar("Ternero");
}
</script>

</body>
</html>
