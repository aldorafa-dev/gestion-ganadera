<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Ganadero B&M</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#f3f5f7;
  --card:#ffffff;
  --primary:#1f7a4f;
  --secondary:#2fa36b;
  --text:#2b2b2b;
  --muted:#6b7280;
  --border:#e5e7eb;
}

*{box-sizing:border-box}

body{
  margin:0;
  font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:var(--bg);
  color:var(--text);
}

/* HEADER */
header{
  background:var(--primary);
  color:white;
  padding:16px;
  font-size:20px;
  font-weight:600;
}

/* LAYOUT */
.container{
  padding:15px;
  max-width:1200px;
  margin:auto;
}

.grid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:16px;
}

.card{
  background:var(--card);
  border-radius:14px;
  padding:16px;
  box-shadow:0 6px 16px rgba(0,0,0,0.06);
}

/* INPUTS */
select,input,button{
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:10px;
  border:1px solid var(--border);
  font-size:15px;
}

button{
  background:var(--secondary);
  color:white;
  border:none;
  font-weight:600;
  cursor:pointer;
}

button.secondary{
  background:#eef6f2;
  color:var(--primary);
}

button:active{transform:scale(0.98)}

h3{
  margin:0 0 10px 0;
  color:var(--primary);
}

.stat{
  display:flex;
  justify-content:space-between;
  padding:10px;
  border-radius:10px;
  background:#f9fafb;
  margin-top:8px;
  cursor:pointer;
}

.stat:hover{background:#eef6f2}

.small{font-size:13px;color:var(--muted)}

.list-item{
  padding:10px;
  border-bottom:1px solid var(--border);
  cursor:pointer;
}

.list-item:hover{background:#f3f5f7}

/* MOBILE */
@media(max-width:800px){
  .grid{grid-template-columns:1fr}
}
</style>
</head>

<body>

<header>Ganadero B&M</header>

<div class="container">

<!-- PASO 0: ESTABLECIMIENTO -->
<div class="card" id="establecimientoCard">
  <h3>Establecimiento</h3>
  <input id="estNombre" placeholder="Nombre del establecimiento">
  <button onclick="setEstablecimiento()">Confirmar establecimiento</button>
</div>

<!-- APP -->
<div id="app" style="display:none">

<div class="grid">

<!-- PASO 1: SELECCIÓN DE RODEO -->
<div class="card">
  <h3>Rodeo activo</h3>

  <select id="rodeoSelect" onchange="mostrarResumen()"></select>

  <div id="resumen"></div>
</div>

<!-- PASO 2: ALTAS -->
<div class="card">
  <h3>Altas</h3>

  <select id="altaTipo" onchange="cambiarAlta()">
    <option value="">¿Qué querés dar de alta?</option>
    <option value="rodeo">Rodeo</option>
    <option value="lote">Lote</option>
    <option value="animal">Animal</option>
  </select>

  <div id="altaForm"></div>
</div>

</div>

<!-- LISTADOS -->
<div class="card" style="margin-top:20px">
  <h3>Listado</h3>
  <div id="listado"></div>
</div>

</div>
</div>

<script>
let data = JSON.parse(localStorage.getItem("ganaderoBM")) || {
  establecimiento:null,
  rodeos:[]
};

function save(){
  localStorage.setItem("ganaderoBM",JSON.stringify(data));
}

/* ESTABLECIMIENTO */
function setEstablecimiento(){
  if(!estNombre.value) return alert("Ingresá nombre");
  data.establecimiento = estNombre.value;
  save();
  initApp();
}

function initApp(){
  establecimientoCard.style.display="none";
  app.style.display="block";
  cargarRodeos();
}

if(data.establecimiento) initApp();

/* RODEOS */
function cargarRodeos(){
  rodeoSelect.innerHTML="<option value=''>Seleccionar rodeo</option>";
  data.rodeos.forEach((r,i)=>{
    rodeoSelect.innerHTML+=`<option value="${i}">${r.nombre}</option>`;
  });
}

/* ALTAS */
function cambiarAlta(){
  altaForm.innerHTML="";
  if(altaTipo.value==="rodeo"){
    altaForm.innerHTML=`
      <input id="nuevoRodeo" placeholder="Nombre del rodeo">
      <button onclick="altaRodeo()">Crear rodeo</button>
    `;
  }
  if(altaTipo.value==="lote"){
    altaForm.innerHTML=`
      <input id="nuevoLote" placeholder="Nombre del lote">
      <button onclick="altaLote()">Crear lote</button>
    `;
  }
  if(altaTipo.value==="animal"){
    altaForm.innerHTML=`
      <select id="animalTipo">
        <option>Vaca</option>
        <option>Toro</option>
        <option>Ternero/a</option>
      </select>
      <input id="animalId" placeholder="Identificación">
      <button onclick="altaAnimal()">Dar de alta</button>
    `;
  }
}

function altaRodeo(){
  data.rodeos.push({nombre:nuevoRodeo.value,lote:"",animales:[]});
  save(); cargarRodeos();
}

function altaLote(){
  let r=data.rodeos[rodeoSelect.value];
  if(!r) return alert("Seleccioná rodeo");
  r.lote=nuevoLote.value;
  save(); mostrarResumen();
}

function altaAnimal(){
  let r=data.rodeos[rodeoSelect.value];
  if(!r) return alert("Seleccioná rodeo");
  r.animales.push({id:animalId.value,tipo:animalTipo.value});
  save(); mostrarResumen();
}

/* RESUMEN */
function mostrarResumen(){
  resumen.innerHTML="";
  listado.innerHTML="";
  let r=data.rodeos[rodeoSelect.value];
  if(!r) return;

  let vacas=r.animales.filter(a=>a.tipo==="Vaca").length;
  let toros=r.animales.filter(a=>a.tipo==="Toro").length;
  let terneros=r.animales.filter(a=>a.tipo==="Ternero/a").length;

  resumen.innerHTML=`
    <div class="stat" onclick="listar('Vaca')">Vacas <b>${vacas}</b></div>
    <div class="stat" onclick="listar('Toro')">Toros <b>${toros}</b></div>
    <div class="stat" onclick="listar('Ternero/a')">Terneros/as <b>${terneros}</b></div>
    <div class="small" style="margin-top:8px">Lote: ${r.lote || "No asignado"}</div>
  `;
}

function listar(tipo){
  let r=data.rodeos[rodeoSelect.value];
  listado.innerHTML="";
  r.animales.filter(a=>a.tipo===tipo).forEach(a=>{
    listado.innerHTML+=`
      <div class="list-item">
        <b>${a.id}</b><br>
        <span class="small">${a.tipo}</span>
      </div>
    `;
  });
}
</script>

</body>
</html>
