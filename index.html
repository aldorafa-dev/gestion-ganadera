<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Ganadero B&M</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --verde:#2e7d32;
  --verde2:#1b5e20;
  --gris:#f3f5f7;
  --borde:#d0d5db;
  --card:#ffffff;
}

body{
  margin:0;
  font-family: "Segoe UI", Roboto, system-ui;
  background:var(--gris);
  color:#222;
}

header{
  background:var(--verde);
  color:white;
  padding:14px 20px;
  font-size:20px;
  font-weight:600;
}

main{
  padding:20px;
  display:grid;
  grid-template-columns: 320px 1fr 420px;
  gap:20px;
}

/* TARJETAS */
.card{
  background:var(--card);
  border-radius:14px;
  padding:16px;
  box-shadow:0 6px 16px rgba(0,0,0,.06);
}

/* TITULOS */
.card h3{
  margin:0 0 12px 0;
  color:var(--verde2);
}

/* FORM */
select,input,button{
  width:100%;
  padding:10px;
  margin:6px 0;
  border-radius:8px;
  border:1px solid var(--borde);
  font-size:14px;
}

button{
  background:var(--verde);
  color:white;
  font-weight:600;
  cursor:pointer;
}
button:hover{ background:var(--verde2); }

/* LISTADOS */
.item{
  border:1px solid var(--borde);
  border-radius:8px;
  padding:8px;
  margin-top:6px;
  cursor:pointer;
}
.item:hover{ background:#eef6ef; }

/* RESUMEN */
.resumen{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:10px;
}
.resumen div{
  background:#eef6ef;
  padding:10px;
  border-radius:10px;
  text-align:center;
}
.resumen b{ font-size:18px; }

small{ color:#666; }
</style>
</head>

<body>

<header>üêÑ Ganadero B&M</header>

<main>

<!-- COLUMNA 1 -->
<div class="card">
  <h3>Configuraci√≥n inicial</h3>

  <label>Establecimiento</label>
  <input id="estNombre" placeholder="Nombre del establecimiento">
  <button onclick="guardarEst()">Guardar</button>

  <hr>

  <label>Rodeo</label>
  <select id="rodeoSel" onchange="mostrarRodeo()"></select>

  <small>El lote se muestra autom√°ticamente</small>
</div>

<!-- COLUMNA 2 -->
<div class="card">
  <h3>Estado del rodeo</h3>

  <div id="loteActual"><small>Seleccione un rodeo</small></div>

  <div class="resumen" id="resumen"></div>

  <div id="listado"></div>
</div>

<!-- COLUMNA 3 -->
<div class="card">
  <h3>Altas</h3>

  <label>¬øQu√© desea dar de alta?</label>
  <select id="tipoAlta" onchange="mostrarAlta()">
    <option value="">Seleccionar</option>
    <option value="vaca">Vaca</option>
    <option value="toro">Toro</option>
    <option value="ternero">Ternero</option>
  </select>

  <div id="formAlta"></div>
</div>

</main>

<script>
/* ====== DATOS ====== */
let data = JSON.parse(localStorage.getItem("ganaderoBM")) || {
  establecimiento:"",
  lotes:[
    {nombre:"Lote 1"},
    {nombre:"Lote 2"}
  ],
  rodeos:[
    {nombre:"Rodeo General", lote:0, animales:[]}
  ],
  ultCaravanaTernero:1,
  fechaDefecto:new Date().toISOString().substr(0,10)
};

function save(){ localStorage.setItem("ganaderoBM",JSON.stringify(data)); }

/* ====== ESTABLECIMIENTO ====== */
function guardarEst(){
  if(!estNombre.value) return;
  data.establecimiento=estNombre.value;
  save();
}

/* ====== RODEOS ====== */
function cargarRodeos(){
  rodeoSel.innerHTML="<option value=''>Seleccionar</option>";
  data.rodeos.forEach((r,i)=>{
    rodeoSel.innerHTML+=`<option value="${i}">${r.nombre}</option>`;
  });
}

function mostrarRodeo(){
  let r=data.rodeos[rodeoSel.value];
  if(!r) return;

  loteActual.innerHTML=`<b>Lote:</b> ${data.lotes[r.lote].nombre}`;

  let vacas=r.animales.filter(a=>a.tipo=="vaca").length;
  let toros=r.animales.filter(a=>a.tipo=="toro").length;
  let terneros=r.animales.filter(a=>a.tipo=="ternero").length;

  resumen.innerHTML=`
    <div onclick="listar('vaca')"><b>${vacas}</b><br>Vacas</div>
    <div onclick="listar('toro')"><b>${toros}</b><br>Toros</div>
    <div onclick="listar('ternero')"><b>${terneros}</b><br>Terneros</div>
  `;
  listado.innerHTML="";
}

function listar(tipo){
  let r=data.rodeos[rodeoSel.value];
  listado.innerHTML="";
  r.animales.filter(a=>a.tipo==tipo).forEach(a=>{
    listado.innerHTML+=`
      <div class="item">
        <b>${a.caravana||"Sin caravana"}</b><br>
        ${a.sexo} - ${a.color}<br>
        <small>Fecha: ${a.fecha}</small>
      </div>`;
  });
}

/* ====== ALTAS ====== */
function mostrarAlta(){
  let t=tipoAlta.value;
  formAlta.innerHTML="";
  if(!t) return;

  if(t=="ternero"){
    formAlta.innerHTML=`
      <label>Sexo</label>
      <select id="sexo">
        <option>M</option>
        <option>H</option>
      </select>

      <label>Color</label>
      <select id="color">
        <option>N</option>
        <option>C</option>
        <option>PN</option>
        <option>PC</option>
      </select>

      <label>Caravana</label>
      <input id="caravana" value="${data.ultCaravanaTernero}">
      <button onclick="sinCaravana()">Sin caravanear</button>

      <label>Fecha</label>
      <input type="date" id="fecha" value="${data.fechaDefecto}">

      <button onclick="altaTernero()">Guardar ternero</button>
    `;
  }
}

function sinCaravana(){
  document.getElementById("caravana").value="";
}

function altaTernero(){
  let r=data.rodeos[rodeoSel.value];
  let car=document.getElementById("caravana").value;

  r.animales.push({
    tipo:"ternero",
    sexo:sexo.value,
    color:color.value,
    caravana:car,
    fecha:fecha.value
  });

  if(car){
    data.ultCaravanaTernero=parseInt(car)+1;
  }
  data.fechaDefecto=fecha.value;
  save();
  mostrarRodeo();
}

/* ====== INIT ====== */
estNombre.value=data.establecimiento;
cargarRodeos();
</script>

</body>
</html>
